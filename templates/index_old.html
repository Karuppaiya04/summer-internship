<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Birthday Reminder</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <!-- Custom CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <i class="bi bi-gift-fill"></i> Birthday Reminder
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link active" href="#all-birthdays">All Birthdays</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#upcoming-birthdays">Upcoming</a>
            </li>
            <li class="nav-item">
              <span class="nav-link">
                <i class="bi bi-person-circle"></i> {{ session.get('username',
                'User') }}
              </span>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/logout">
                <i class="bi bi-box-arrow-right"></i> Logout
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-5">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-md-8">
          <h1 class="display-4">Birthday Management</h1>
          <p class="lead">Never forget a birthday again!</p>
        </div>
        <div class="col-md-4 text-end">
          <button
            class="btn btn-success btn-lg me-2"
            onclick="sendBulkWhatsAppMessages()"
            title="Send WhatsApp birthday wishes to everyone with a birthday today! &#10;&#10;ðŸ’¡ TIP: Please allow pop-ups for this site when prompted."
            data-bs-toggle="tooltip"
            data-bs-placement="bottom"
          >
            <i class="bi bi-whatsapp"></i> Send Wishes
          </button>
          <button
            class="btn btn-primary btn-lg"
            data-bs-toggle="modal"
            data-bs-target="#addBirthdayModal"
          >
            <i class="bi bi-plus-circle"></i> Add Birthday
          </button>
        </div>
      </div>

      <!-- Upcoming Birthdays Alert -->
      <div id="upcomingAlert" class="alert alert-info" style="display: none">
        <h5>
          <i class="bi bi-calendar-event"></i> Upcoming Birthdays (Next 30 Days)
        </h5>
        <div id="upcomingList"></div>
      </div>

      <!-- Search Bar -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input
              type="text"
              class="form-control"
              id="searchInput"
              placeholder="Search by name..."
            />
          </div>
        </div>
        <div class="col-md-6 text-end">
          <div class="view-toggle d-inline-flex">
            <button class="active" onclick="switchView('table')">
              <i class="bi bi-table"></i> Table
            </button>
            <button onclick="switchView('card')">
              <i class="bi bi-grid-3x3-gap"></i> Cards
            </button>
            <button onclick="switchView('calendar')">
              <i class="bi bi-calendar3"></i> Calendar
            </button>
          </div>
          <button
            class="btn btn-success export-btn ms-2"
            onclick="exportToCSV()"
          >
            <i class="bi bi-download"></i> Export
          </button>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-icon total">
            <i class="bi bi-people-fill"></i>
          </div>
          <div class="stat-info">
            <h3 id="totalCount">0</h3>
            <p>Total Birthdays</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon today">
            <i class="bi bi-cake2-fill"></i>
          </div>
          <div class="stat-info">
            <h3 id="todayCount">0</h3>
            <p>Today</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon upcoming">
            <i class="bi bi-calendar-check-fill"></i>
          </div>
          <div class="stat-info">
            <h3 id="upcomingCount">0</h3>
            <p>Next 7 Days</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon thismonth">
            <i class="bi bi-calendar-month-fill"></i>
          </div>
          <div class="stat-info">
            <h3 id="monthCount">0</h3>
            <p>This Month</p>
          </div>
        </div>
      </div>

      <!-- Filter Buttons -->
      <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="today">Today</button>
        <button class="filter-btn" data-filter="week">This Week</button>
        <button class="filter-btn" data-filter="month">This Month</button>
      </div>

      <!-- Birthdays Table -->
      <div class="card shadow" id="tableView">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-list-ul"></i> All Birthdays</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th class="sortable" data-sort="name">Name</th>
                  <th class="sortable" data-sort="birthDate">Birth Date</th>
                  <th class="sortable" data-sort="age">Age</th>
                  <th class="sortable" data-sort="daysUntil">Days Until</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="birthdaysTableBody">
                <!-- Data will be loaded here by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Birthday Cards View -->
      <div class="birthday-cards" id="cardView" style="display: none">
        <!-- Cards will be loaded here by JavaScript -->
      </div>

      <!-- Birthday Calendar View -->
      <div class="calendar-view" id="calendarView" style="display: none">
        <div class="card shadow">
          <div
            class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
          >
            <button class="btn btn-light btn-sm" onclick="previousMonth()">
              <i class="bi bi-chevron-left"></i>
            </button>
            <h5 class="mb-0" id="calendarMonth">
              <i class="bi bi-calendar3"></i> <span id="monthYear"></span>
            </h5>
            <button class="btn btn-light btn-sm" onclick="nextMonth()">
              <i class="bi bi-chevron-right"></i>
            </button>
          </div>
          <div class="card-body p-0">
            <div class="calendar-grid" id="calendarGrid">
              <!-- Calendar will be rendered here -->
            </div>
          </div>
        </div>

        <!-- Calendar Legend -->
        <div class="calendar-legend mt-3">
          <div class="legend-item">
            <span class="legend-dot today-dot"></span>
            <span>Today</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot birthday-dot"></span>
            <span>Has Birthday</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot selected-dot"></span>
            <span>Selected Day</span>
          </div>
        </div>

        <!-- Birthday Details Panel -->
        <div
          class="birthday-details-panel mt-3"
          id="birthdayDetails"
          style="display: none"
        >
          <div class="card shadow">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0">
                <i class="bi bi-cake2-fill"></i> Birthdays on
                <span id="selectedDate"></span>
              </h5>
            </div>
            <div class="card-body" id="birthdayDetailsList">
              <!-- Birthday details will be shown here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Particles Background -->
    <div class="particles" id="particles"></div>

    <!-- Dark Mode Toggle -->
    <button
      class="theme-toggle"
      onclick="toggleTheme()"
      title="Toggle Dark Mode"
    >
      <i class="bi bi-moon-stars-fill" id="themeIcon"></i>
    </button>

    <!-- Scroll to Top Button -->
    <div class="scroll-to-top" onclick="scrollToTop()">
      <i class="bi bi-arrow-up"></i>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Add/Edit Birthday Modal -->
    <div class="modal fade" id="addBirthdayModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="modalTitle">Add Birthday</h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="birthdayForm">
              <input type="hidden" id="birthdayId" />
              <div class="mb-3">
                <label for="name" class="form-label">Name *</label>
                <input type="text" class="form-control" id="name" required />
              </div>
              <div class="mb-3">
                <label for="birthDate" class="form-label">Birth Date *</label>
                <input
                  type="date"
                  class="form-control"
                  id="birthDate"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" />
              </div>
              <div class="mb-3">
                <label for="phone" class="form-label">Phone</label>
                <input type="tel" class="form-control" id="phone" />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveBirthday()"
            >
              Save
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title">Confirm Delete</h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            Are you sure you want to delete this birthday?
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-danger"
              onclick="confirmDelete()"
            >
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- WhatsApp Message Modal -->
    <div class="modal fade" id="whatsappModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title">
              <i class="bi bi-whatsapp"></i> Send Birthday Wish
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="whatsappForm">
              <input type="hidden" id="whatsappBirthdayId" />
              <input type="hidden" id="whatsappPhone" />
              <div class="mb-3">
                <label class="form-label"><strong>To:</strong></label>
                <p id="whatsappRecipient" class="text-muted"></p>
              </div>
              <div class="mb-3">
                <label for="whatsappMessage" class="form-label">Message:</label>
                <textarea
                  class="form-control"
                  id="whatsappMessage"
                  rows="6"
                  placeholder="Your birthday message..."
                ></textarea>
                <small class="text-muted"
                  >Default message will be used if left empty</small
                >
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-success"
              onclick="sendWhatsAppMessage()"
            >
              <i class="bi bi-whatsapp"></i> Send via WhatsApp
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
  </body>
</html>
